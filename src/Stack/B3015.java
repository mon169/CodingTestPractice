package Stack; // ğŸ“¦ ë¡œì»¬ ì‹¤í–‰/ì—°ìŠµìš© íŒ¨í‚¤ì§€. ë°±ì¤€ ì œì¶œ ì‹œ ë°˜ë“œì‹œ ì œê±°!

import java.io.*;
import java.util.*;

public class B3015 {

    /*
     ìŠ¤íƒì— ì €ì¥í•  ì›ì†Œì˜ ìë£Œí˜•
     - height: í•´ë‹¹ ê·¸ë£¹(ì—°ì† êµ¬ê°„)ì˜ í‚¤
     - count : ê°™ì€ í‚¤ê°€ ì—°ì†ìœ¼ë¡œ ëª‡ ëª… ìˆëŠ”ì§€(ê·¸ë£¹ í¬ê¸°)
     [ ... 180, 180, 180 ] ë¼ë©´ (height=180, count=3) í•˜ë‚˜ë¡œ ë¬¶ì–´ì„œ ì €ì¥
     ì´ë ‡ê²Œ ê·¸ë£¹í•‘í•˜ë©´ ê°™ì€ í‚¤ êµ¬ê°„ì„ O(1)ë¡œ ì²˜ë¦¬í•  ìˆ˜ ìˆì–´ ì „ì²´ê°€ O(N)ì— ê°€ê¹ê²Œ ì‘ë™
     */
    static class Pair {
        int height;   // ì‚¬ëŒ í‚¤
        int count;    // ê°™ì€ í‚¤ë¥¼ ê°€ì§„ ì—°ì†ëœ ì‚¬ëŒ ìˆ˜

        Pair(int height, int count) {
            this.height = height;
            this.count = count;
        }
    }

    public static void main(String[] args) throws IOException {
        // ë¹ ë¥¸ ì…ë ¥
        BufferedReader br = new BufferedReader(new InputStreamReader(System.in));
        int N = Integer.parseInt(br.readLine()); // ì‚¬ëŒ ìˆ˜ (ìµœëŒ€ 500,000)

        // ìŠ¤íƒ: "ì•„ì§ ì˜¤ë¥¸ìª½ì—ì„œ ë” í° í‚¤ë¥¼ ë§Œë‚˜ì§€ ì•Šì•„ ì‹œì•¼ê°€ í™•ì •ë˜ì§€ ì•Šì€ ê·¸ë£¹"ë“¤ì„ ì €ì¥
        Stack<Pair> stack = new Stack<>();

        // ì •ë‹µì€ long (ìŒì˜ ê°œìˆ˜ê°€ ë§¤ìš° ì»¤ì§ˆ ìˆ˜ ìˆìŒ)
        long answer = 0;

        for (int i = 0; i < N; i++) {
            int h = Integer.parseInt(br.readLine()); // í˜„ì¬ ì‚¬ëŒì˜ í‚¤
            int sameCount = 1; // í˜„ì¬ í‚¤ hê°€ ì—°ì†í•´ì„œ ëª‡ ëª…ì¸ì§€ (ê¸°ë³¸ì€ ìê¸° ìì‹  1ëª…)

            /*
             í˜„ì¬ í‚¤ hê°€ ìŠ¤íƒ top(ì™¼ìª½ì— ìˆë˜ ê·¸ë£¹)ì˜ í‚¤ë³´ë‹¤ í´ ë•Œ:
             - top ê·¸ë£¹ì€ hì— ì˜í•´ ê°€ë ¤ì§ â†’ ì´ì œ ë” ì˜¤ë¥¸ìª½ ì‚¬ëŒê³¼ ì„œë¡œ ë³¼ ìˆ˜ ì—†ìŒ
             - í•˜ì§€ë§Œ popë˜ëŠ” ê° ê·¸ë£¹ì˜ ì‚¬ëŒë“¤ì€ "í˜„ì¬ ì‚¬ëŒ h"ì™€ëŠ” ëª¨ë‘ ì„œë¡œ ë³¼ ìˆ˜ ìˆì—ˆìŒ
             (ì¤‘ê°„ì— hê°€ ë“±ì¥í•˜ê¸° ì „ê¹Œì§€ ë” í° í‚¤ê°€ ì—†ì—ˆê¸° ë•Œë¬¸)
             ë”°ë¼ì„œ ê·¸ ê·¸ë£¹ì˜ countë§Œí¼ ìŒì„ ì¶”ê°€
             ì´ ê³¼ì •ì„ hë³´ë‹¤ ì‘ì€ í‚¤ë“¤ì´ ì—†ì–´ì§ˆ ë•Œê¹Œì§€ ë°˜ë³µ

             ì˜ˆ) ... [170 x 2], í˜„ì¬ h=180 ì´ë©´
             170 ê·¸ë£¹(2ëª…)ì€ hì™€ ê°ê° ìŒì„ 2ê°œ ë§Œë“  ë’¤ pop
             */
            while (!stack.isEmpty() && stack.peek().height < h) {
                answer += stack.peek().count; // í˜„ì¬ hì™€ ìŠ¤íƒ top ê·¸ë£¹ ì‚¬ëŒë“¤ ëª¨ë‘ ì„œë¡œ ë³´ì„ â†’ ìŒ += ê·¸ë£¹í¬ê¸°
                stack.pop();                  // ì´ì œ hê°€ ë“±ì¥í–ˆìœ¼ë‹ˆ, ì´ ê·¸ë£¹ì€ ë” ì´ìƒ ë’¤ìª½ê³¼ ë³¼ ìˆ˜ ì—†ìŒ â†’ ì œê±°
            }

            /*
             í˜„ì¬ í‚¤ hê°€ ìŠ¤íƒ topê³¼ ê°™ì€ ê²½ìš°:
             - ê°™ì€ í‚¤ ì‚¬ëŒë¼ë¦¬ëŠ” ì„œë¡œ 'ëª¨ë“  ìŒ'ì´ ë³´ì„
             - ë°”ë¡œ ì™¼ìª½ì— ìˆë˜ ê°™ì€ í‚¤ ê·¸ë£¹ì˜ í¬ê¸°ë¥¼ í•©ì³ì„œ(=top.count) ìŒì„ ë”í•˜ê³ ,
             í˜„ì¬ ì‚¬ëŒì„ í¬í•¨í•´ sameCountë¥¼ top.count + 1ë¡œ ê°±ì‹ 
             - ê·¸ë¦¬ê³ , ê°™ì€ í‚¤ë“¤ì„ í•©ì¹œ ë’¤ì—ë„ ìŠ¤íƒ ì•ˆì— 'ë” í° í‚¤'ê°€ ë‚¨ì•„ ìˆë‹¤ë©´,
             ê·¸ 'ë” í° í‚¤'ì™€ë„ í˜„ì¬ ì‚¬ëŒì€ ì„œë¡œ ë³¼ ìˆ˜ ìˆìœ¼ë¯€ë¡œ +1

             ì˜ˆ) ìŠ¤íƒ top=(180,3), í˜„ì¬ h=180 ì´ë©´
             180ë¼ë¦¬ 3ìŒ ì¶”ê°€(answer += 3), sameCount=4ë¡œ ë§Œë“¤ê³ ,
             ìŠ¤íƒì— ë” í° í‚¤ê°€ ë‚¨ì•„ ìˆìœ¼ë©´ ê·¸ í° í‚¤ì™€ë„ 1ìŒ ì¶”ê°€
             */
            if (!stack.isEmpty() && stack.peek().height == h) {
                Pair top = stack.pop();    // ê°™ì€ í‚¤ ê·¸ë£¹ì„ êº¼ëƒ„
                answer += top.count;       // ê°™ì€ í‚¤ë¼ë¦¬ëŠ” ì„œë¡œ ëª¨ë‘ ë³´ì„ â†’ ìŒ += ê·¸ë£¹í¬ê¸°
                sameCount = top.count + 1; // ê°™ì€ í‚¤ ì—°ì† ê°œìˆ˜ ê°±ì‹ (ê¸°ì¡´ ê·¸ë£¹ + í˜„ì¬ ë³¸ì¸)

                // ê°™ì€ í‚¤ë“¤ì„ í•©ì¹œ ë’¤ì—ë„ ìŠ¤íƒì— 'ë” í° í‚¤'ê°€ ë‚¨ì•„ ìˆìœ¼ë©´ ê·¸ í° í‚¤ì™€ë„ ì„œë¡œ ë³´ì„ â†’ +1
                if (!stack.isEmpty()) answer++;
            }
            /*
             í˜„ì¬ í‚¤ hê°€ ìŠ¤íƒ topë³´ë‹¤ ì‘ì€ ê²½ìš°:
             - í˜„ì¬ ì‚¬ëŒì€ ìŠ¤íƒ top(ì™¼ìª½ì˜ ë” í° í‚¤)ê³¼ëŠ” ì„œë¡œ ë³¼ ìˆ˜ ìˆìŒ â†’ +1
             - ê°™ì€ í‚¤ëŠ” ì•„ë‹ˆë¯€ë¡œ sameCountëŠ” 1 ê·¸ëŒ€ë¡œ
             ì˜ˆ) ìŠ¤íƒ top=(190,x), í˜„ì¬ h=175 â†’ 175ëŠ” 190ê³¼ 1ìŒ
             */
            else if (!stack.isEmpty()) {
                answer++; // ìŠ¤íƒ topì˜ ë” í° í‚¤ 1ëª…ê³¼ëŠ” ë°˜ë“œì‹œ ì„œë¡œ ë³¼ ìˆ˜ ìˆìŒ
            }

            // í˜„ì¬ ì‚¬ëŒì„ ìŠ¤íƒì— push
            // ê°™ì€ í‚¤ê°€ ì—°ì†í•´ ë“¤ì–´ì˜¤ë©´ í•©ì³ì„œ (height=h, count=ì—°ì†ìˆ˜)ë¡œ ê´€ë¦¬í•´,
            // ì´í›„ ì—°ì‚°ì„ O(1)ë¡œ ì²˜ë¦¬í•  ìˆ˜ ìˆê²Œ í•¨
            stack.push(new Pair(h, sameCount));
        }

        // ì •ë‹µ ì¶œë ¥
        System.out.println(answer);
    }
}